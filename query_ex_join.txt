-- QUERY ESERCIZIO DB SQL 2

-- 1. SELEZIONARE TUTTI GLI STUDENTI ISCRITTI AL CORSO DI LAUREA IN ECONOMIA
SELECT
	DISTINCT 
	STUDENTS.NAME AS NAME_STUDENT,
	DEGREES.NAME AS NAME_COURSE
FROM
	STUDENTS
INNER JOIN DEGREES ON
	STUDENTS.DEGREE_ID = DEGREES.ID
INNER JOIN COURSES ON
	COURSES.DEGREE_ID = DEGREES.ID
WHERE
	DEGREES.NAME = 'CORSO DI LAUREA IN ECONOMIA';


-- 2. SELEZIONARE TUTTI I CORSI DI LAUREA MAGISTRALE DEL DIPARTIMENTO DI NEUROSCIENZE
SELECT
	DISTINCT 
	COURSES.ID AS ID_COURSE,
	COURSES.NAME AS NAME_COURSE,
	DEGREES.NAME AS NAME_DEGREES,
	DEPARTMENTS.NAME AS NAME_DEPARTMENT
FROM
	COURSES
INNER JOIN DEGREES ON
	COURSES.DEGREE_ID = DEGREES.ID
INNER JOIN DEPARTMENTS ON
	DEGREES.DEPARTMENT_ID = DEPARTMENTS.ID
WHERE
	DEPARTMENTS.NAME = 'DIPARTIMENTO DI NEUROSCIENZE';
	

-- 3. SELEZIONARE TUTTI I CORSI IN CUI INSEGNA FULVIO AMATO (ID=44)
SELECT
	DISTINCT 
	COURSES.NAME AS NAME_COURSE,
	TEACHERS.NAME AS NAME_TEACHER,
	TEACHERS.SURNAME AS SURNAME_TEACHER
FROM
	COURSE_TEACHER
INNER JOIN TEACHERS ON
	TEACHERS.ID = COURSE_TEACHER.TEACHER_ID
INNER JOIN COURSES ON
	COURSES.ID = COURSE_TEACHER.COURSE_ID
WHERE
	COURSE_TEACHER.TEACHER_ID = 44;
	

-- 4. SELEZIONARE TUTTI GLI STUDENTI CON I DATI RELATIVI AL CORSO DI LAUREA A CUI SONO ISCRITTI E IL RELATIVO DIPARTIMENTO, IN ORDINE ALFABETICO PER COGNOME E NOME
SELECT
	DISTINCT 
	STUDENTS.NAME AS NAME_STUDENT,
	STUDENTS.SURNAME AS SURNAME_STUDENT,
	DEGREES.NAME AS NAME_DEGREES,
	DEPARTMENTS.NAME AS NAME_DEPARTMENTS
FROM
	STUDENTS
INNER JOIN DEGREES ON
	STUDENTS.DEGREE_ID = DEGREES.ID
INNER JOIN DEPARTMENTS ON
	DEGREES.DEPARTMENT_ID = DEPARTMENTS.ID
ORDER BY
	STUDENTS.NAME,
	STUDENTS.SURNAME;
	

-- 5. SELEZIONARE TUTTI I CORSI DI LAUREA CON I RELATIVI CORSI E INSEGNANTI
SELECT
	DISTINCT
	DEGREES.NAME AS NAME_DEGREES,
	COURSES.NAME AS NAME_COURSE,
	TEACHERS.NAME AS NAME_TEACHER,
	TEACHERS.SURNAME AS SURNAME_TEACHER
FROM
	COURSE_TEACHER
INNER JOIN TEACHERS ON
	TEACHERS.ID = COURSE_TEACHER.TEACHER_ID
INNER JOIN COURSES ON
	COURSES.ID = COURSE_TEACHER.COURSE_ID
INNER JOIN DEGREES ON
	COURSES.DEGREE_ID = DEGREES.ID;


-- 6. SELEZIONARE TUTTI I DOCENTI CHE INSEGNANO NEL DIPARTIMENTO DI MATEMATICA (54)
SELECT
	DISTINCT
	TEACHERS.NAME AS NAME_TEACHER,
	TEACHERS.SURNAME AS SURNAME_TEACHER,
	DEPARTMENTS.NAME AS NAME_DEPARTMENTS
FROM
	COURSE_TEACHER
INNER JOIN TEACHERS ON
	TEACHERS.ID = COURSE_TEACHER.TEACHER_ID
INNER JOIN COURSES ON
	COURSES.ID = COURSE_TEACHER.COURSE_ID
INNER JOIN DEGREES ON
	COURSES.DEGREE_ID = DEGREES.ID
INNER JOIN DEPARTMENTS ON
	DEPARTMENTS.ID = DEGREES.DEPARTMENT_ID
WHERE
	DEPARTMENTS.NAME = 'DIPARTIMENTO DI MATEMATICA';
	

-- 7. BONUS: SELEZIONARE PER OGNI STUDENTE QUANTI TENTATIVI Dâ€™ESAME HA SOSTENUTO PER SUPERARE CIASCUNO DEI SUOI ESAMI
SELECT
	STUDENTS.NAME AS NAME_STUDENT,
	STUDENTS.SURNAME AS SURNAME_STUDENT,
	COUNT(EXAM_ID) AS REPEATS_EXAM
FROM
	EXAM_STUDENT
INNER JOIN STUDENTS ON
	EXAM_STUDENT.STUDENT_ID = STUDENTS.ID
INNER JOIN EXAMS ON
	EXAM_STUDENT.EXAM_ID = EXAMS.ID
WHERE
	EXAM_STUDENT.VOTE < 18
GROUP BY
	STUDENT_ID;